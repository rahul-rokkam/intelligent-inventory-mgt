resources:
  jobs:
    data_initialization:
      name: "[${bundle.target}] SmartStock Data Initialization"
      
      # Grant permissions to all workspace users to run this job
      permissions:
        - group_name: users
          level: CAN_MANAGE_RUN
      
      tasks:
        - task_key: bronze_tables
          notebook_task:
            notebook_path: ../../src/smartstock_v2/bronze_tables.py
            base_parameters:
              catalog: ${var.catalog_name}
              schema: ${var.schema_name}
              env: ${bundle.target}

        - task_key: silver_tables
          depends_on:
            - task_key: bronze_tables
          notebook_task:
            notebook_path: ../../src/smartstock_v2/silver_tables.py
            base_parameters:
              catalog: ${var.catalog_name}
              schema: ${var.schema_name}
              env: ${bundle.target}

        - task_key: gold_tables
          depends_on:
            - task_key: silver_tables
          notebook_task:
            notebook_path: ../../src/smartstock_v2/gold_tables.py
            base_parameters:
              catalog: ${var.catalog_name}
              schema: ${var.schema_name}
              env: ${bundle.target}

        - task_key: sales_history
          depends_on:
            - task_key: gold_tables
          notebook_task:
            notebook_path: ../../src/smartstock_v2/sales_history.py
            base_parameters:
              catalog: ${var.catalog_name}
              schema: ${var.schema_name}
              env: ${bundle.target}

      queue:
        enabled: true